<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=320,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <link rel="shortcut icon" href="/static/images/icon.png">
    <link href="/static/css/main.css" rel="stylesheet" type="text/css">

    <title></title>
</head>
<body>
<script>
    if (/mobile/i.test(navigator.userAgent) || /android/i.test(navigator.userAgent))
    {
        document.body.classList.add('mobile');
    }
</script>
<header>
    <nav>
        <input type="checkbox" id="nav-toggle" class="nav-toggle"/>
        <label for="nav-toggle">
                <span class="menu-icon">
                    <svg viewBox="0 0 18 15" width="18px" height="15px">
                        <path fill="white"
                              d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                        <path fill="white"
                              d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                        <path fill="white"
                              d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                   </svg>
              </span>
        </label>
        <a class="title" href="/">码农大陆 World of CodeMonkey</a>
    
        <div class="nav-item">
            <ul class="nav-start">
            <li><a href="/lang" >编程语言</a></li>
            <li><a href="/game" >游戏编程</a></li>
            <li><a href="/book"  class="active" >读书笔记</a></li>
            </ul>
            <ul class="nav-end">
                <li><a href="/about"  >关于</a></li>
                <li><a href="#">捐赠</a></li>
            </ul>
        </div>
    </nav>
</header>
<main>
    <div class="container">
        <div class="inner">
        
<h1><a name="2-6-interface" class="anchor" href="#2-6-interface" rel="nofollow" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.6 interface</h1>
<h2><a name="interface" class="anchor" href="#interface" rel="nofollow" aria-hidden="true"><span class="octicon octicon-link"></span></a>
interface</h2>

<p>Go语言里面设计最精妙的应该算interface，它让面向对象，内容组织实现非常的方便，当你看完这一章，你就会被interface的巧妙设计所折服。</p>
<h3><a name="什么是interface" class="anchor" href="#%E4%BB%80%E4%B9%88%E6%98%AFinterface" rel="nofollow" aria-hidden="true"><span class="octicon octicon-link"></span></a>
什么是interface</h3>

<p>简单的说，interface是一组method签名的组合，我们通过interface来定义对象的一组行为。</p>

<p>我们前面一章最后一个例子中Student和Employee都能SayHi，虽然他们的内部实现不一样，但是那不重要，重要的是他们都能<code>say hi</code></p>

<p>让我们来继续做更多的扩展，Student和Employee实现另一个方法<code>Sing</code>，然后Student实现方法BorrowMoney而Employee实现SpendSalary。</p>

<p>这样Student实现了三个方法：SayHi、Sing、BorrowMoney；而Employee实现了SayHi、Sing、SpendSalary。</p>

<p>上面这些方法的组合称为interface(被对象Student和Employee实现)。例如Student和Employee都实现了interface：SayHi和Sing，也就是这两个对象是该interface类型。而Employee没有实现这个interface：SayHi、Sing和BorrowMoney，因为Employee没有实现BorrowMoney这个方法。</p>
<h3><a name="interface类型" class="anchor" href="#interface%E7%B1%BB%E5%9E%8B" rel="nofollow" aria-hidden="true"><span class="octicon octicon-link"></span></a>
interface类型</h3>

<p>interface类型定义了一组方法，如果某个对象实现了某个接口的所有方法，则此对象就实现了此接口。详细的语法参考下面这个例子</p>

<div class="highlight highlight-Go"><pre>
<span class="k">type</span> <span class="n">Human</span> <span class="k">struct</span> <span class="n">{</span>
    <span class="n">name</span> <span class="n">string</span>
    <span class="n">age</span> <span class="n">int</span>
    <span class="n">phone</span> <span class="n">string</span>
<span class="n">}</span>

<span class="k">type</span> <span class="n">Student</span> <span class="k">struct</span> <span class="n">{</span>
    <span class="n">Human</span> <span class="c">//匿名字段Human</span>
    <span class="n">school</span> <span class="n">string</span>
    <span class="n">loan</span> <span class="n">float32</span>
<span class="n">}</span>

<span class="k">type</span> <span class="n">Employee</span> <span class="k">struct</span> <span class="n">{</span>
    <span class="n">Human</span> <span class="c">//匿名字段Human</span>
    <span class="n">company</span> <span class="n">string</span>
    <span class="n">money</span> <span class="n">float32</span>
<span class="n">}</span>

<span class="c">//Human对象实现Sayhi方法</span>
<span class="k">func</span> <span class="n">(</span><span class="n">h</span> <span class="k">*</span><span class="n">Human</span><span class="n">)</span> <span class="n">SayHi</span><span class="n">(</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">fmt</span><span class="n">.</span><span class="n">Printf</span><span class="n">(</span><span class="s">&#34;Hi, I am %s you can call me on %s\n&#34;</span><span class="n">,</span> <span class="n">h</span><span class="n">.</span><span class="n">name</span><span class="n">,</span> <span class="n">h</span><span class="n">.</span><span class="n">phone</span><span class="n">)</span>
<span class="n">}</span>

<span class="c">// Human对象实现Sing方法</span>
<span class="k">func</span> <span class="n">(</span><span class="n">h</span> <span class="k">*</span><span class="n">Human</span><span class="n">)</span> <span class="n">Sing</span><span class="n">(</span><span class="n">lyrics</span> <span class="n">string</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;La la, la la la, la la la la la...&#34;</span><span class="n">,</span> <span class="n">lyrics</span><span class="n">)</span>
<span class="n">}</span>

<span class="c">//Human对象实现Guzzle方法</span>
<span class="k">func</span> <span class="n">(</span><span class="n">h</span> <span class="k">*</span><span class="n">Human</span><span class="n">)</span> <span class="n">Guzzle</span><span class="n">(</span><span class="n">beerStein</span> <span class="n">string</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;Guzzle Guzzle Guzzle...&#34;</span><span class="n">,</span> <span class="n">beerStein</span><span class="n">)</span>
<span class="n">}</span>

<span class="c">// Employee重载Human的Sayhi方法</span>
<span class="k">func</span> <span class="n">(</span><span class="n">e</span> <span class="k">*</span><span class="n">Employee</span><span class="n">)</span> <span class="n">SayHi</span><span class="n">(</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">fmt</span><span class="n">.</span><span class="n">Printf</span><span class="n">(</span><span class="s">&#34;Hi, I am %s, I work at %s. Call me on %s\n&#34;</span><span class="n">,</span> <span class="n">e</span><span class="n">.</span><span class="n">name</span><span class="n">,</span>
        <span class="n">e</span><span class="n">.</span><span class="n">company</span><span class="n">,</span> <span class="n">e</span><span class="n">.</span><span class="n">phone</span><span class="n">)</span> <span class="c">//此句可以分成多行</span>
<span class="n">}</span>

<span class="c">//Student实现BorrowMoney方法</span>
<span class="k">func</span> <span class="n">(</span><span class="n">s</span> <span class="k">*</span><span class="n">Student</span><span class="n">)</span> <span class="n">BorrowMoney</span><span class="n">(</span><span class="n">amount</span> <span class="n">float32</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">s</span><span class="n">.</span><span class="n">loan</span> <span class="k">+=</span> <span class="n">amount</span> <span class="c">// (again and again and...)</span>
<span class="n">}</span>

<span class="c">//Employee实现SpendSalary方法</span>
<span class="k">func</span> <span class="n">(</span><span class="n">e</span> <span class="k">*</span><span class="n">Employee</span><span class="n">)</span> <span class="n">SpendSalary</span><span class="n">(</span><span class="n">amount</span> <span class="n">float32</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">e</span><span class="n">.</span><span class="n">money</span> <span class="k">-=</span> <span class="n">amount</span> <span class="c">// More vodka please!!! Get me through the day!</span>
<span class="n">}</span>

<span class="c">// 定义interface</span>
<span class="k">type</span> <span class="n">Men</span> <span class="k">interface</span> <span class="n">{</span>
    <span class="n">SayHi</span><span class="n">(</span><span class="n">)</span>
    <span class="n">Sing</span><span class="n">(</span><span class="n">lyrics</span> <span class="n">string</span><span class="n">)</span>
    <span class="n">Guzzle</span><span class="n">(</span><span class="n">beerStein</span> <span class="n">string</span><span class="n">)</span>
<span class="n">}</span>

<span class="k">type</span> <span class="n">YoungChap</span> <span class="k">interface</span> <span class="n">{</span>
    <span class="n">SayHi</span><span class="n">(</span><span class="n">)</span>
    <span class="n">Sing</span><span class="n">(</span><span class="n">song</span> <span class="n">string</span><span class="n">)</span>
    <span class="n">BorrowMoney</span><span class="n">(</span><span class="n">amount</span> <span class="n">float32</span><span class="n">)</span>
<span class="n">}</span>

<span class="k">type</span> <span class="n">ElderlyGent</span> <span class="k">interface</span> <span class="n">{</span>
    <span class="n">SayHi</span><span class="n">(</span><span class="n">)</span>
    <span class="n">Sing</span><span class="n">(</span><span class="n">song</span> <span class="n">string</span><span class="n">)</span>
    <span class="n">SpendSalary</span><span class="n">(</span><span class="n">amount</span> <span class="n">float32</span><span class="n">)</span>
<span class="n">}</span>
</pre></div>

<p>通过上面的代码我们可以知道，interface可以被任意的对象实现。我们看到上面的Men interface被Human、Student和Employee实现。同理，一个对象可以实现任意多个interface，例如上面的Student实现了Men和YoungChap两个interface。</p>

<p>最后，任意的类型都实现了空interface(我们这样定义：interface{})，也就是包含0个method的interface。</p>
<h3><a name="interface值" class="anchor" href="#interface%E5%80%BC" rel="nofollow" aria-hidden="true"><span class="octicon octicon-link"></span></a>
interface值</h3>

<p>那么interface里面到底能存什么值呢？如果我们定义了一个interface的变量，那么这个变量里面可以存实现这个interface的任意类型的对象。例如上面例子中，我们定义了一个Men interface类型的变量m，那么m里面可以存Human、Student或者Employee值。</p>

<p>因为m能够持有这三种类型的对象，所以我们可以定义一个包含Men类型元素的slice，这个slice可以被赋予实现了Men接口的任意结构的对象，这个和我们传统意义上面的slice有所不同。</p>

<p>让我们来看一下下面这个例子:</p>

<div class="highlight highlight-Go"><pre>
<span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="s">&#34;fmt&#34;</span>

<span class="k">type</span> <span class="n">Human</span> <span class="k">struct</span> <span class="n">{</span>
    <span class="n">name</span> <span class="n">string</span>
    <span class="n">age</span> <span class="n">int</span>
    <span class="n">phone</span> <span class="n">string</span>
<span class="n">}</span>

<span class="k">type</span> <span class="n">Student</span> <span class="k">struct</span> <span class="n">{</span>
    <span class="n">Human</span> <span class="c">//匿名字段</span>
    <span class="n">school</span> <span class="n">string</span>
    <span class="n">loan</span> <span class="n">float32</span>
<span class="n">}</span>

<span class="k">type</span> <span class="n">Employee</span> <span class="k">struct</span> <span class="n">{</span>
    <span class="n">Human</span> <span class="c">//匿名字段</span>
    <span class="n">company</span> <span class="n">string</span>
    <span class="n">money</span> <span class="n">float32</span>
<span class="n">}</span>

<span class="c">//Human实现SayHi方法</span>
<span class="k">func</span> <span class="n">(</span><span class="n">h</span> <span class="n">Human</span><span class="n">)</span> <span class="n">SayHi</span><span class="n">(</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">fmt</span><span class="n">.</span><span class="n">Printf</span><span class="n">(</span><span class="s">&#34;Hi, I am %s you can call me on %s\n&#34;</span><span class="n">,</span> <span class="n">h</span><span class="n">.</span><span class="n">name</span><span class="n">,</span> <span class="n">h</span><span class="n">.</span><span class="n">phone</span><span class="n">)</span>
<span class="n">}</span>

<span class="c">//Human实现Sing方法</span>
<span class="k">func</span> <span class="n">(</span><span class="n">h</span> <span class="n">Human</span><span class="n">)</span> <span class="n">Sing</span><span class="n">(</span><span class="n">lyrics</span> <span class="n">string</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;La la la la...&#34;</span><span class="n">,</span> <span class="n">lyrics</span><span class="n">)</span>
<span class="n">}</span>

<span class="c">//Employee重载Human的SayHi方法</span>
<span class="k">func</span> <span class="n">(</span><span class="n">e</span> <span class="n">Employee</span><span class="n">)</span> <span class="n">SayHi</span><span class="n">(</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">fmt</span><span class="n">.</span><span class="n">Printf</span><span class="n">(</span><span class="s">&#34;Hi, I am %s, I work at %s. Call me on %s\n&#34;</span><span class="n">,</span> <span class="n">e</span><span class="n">.</span><span class="n">name</span><span class="n">,</span>
        <span class="n">e</span><span class="n">.</span><span class="n">company</span><span class="n">,</span> <span class="n">e</span><span class="n">.</span><span class="n">phone</span><span class="n">)</span>
    <span class="n">}</span>

<span class="c">// Interface Men被Human,Student和Employee实现</span>
<span class="c">// 因为这三个类型都实现了这两个方法</span>
<span class="k">type</span> <span class="n">Men</span> <span class="k">interface</span> <span class="n">{</span>
    <span class="n">SayHi</span><span class="n">(</span><span class="n">)</span>
    <span class="n">Sing</span><span class="n">(</span><span class="n">lyrics</span> <span class="n">string</span><span class="n">)</span>
<span class="n">}</span>

<span class="k">func</span> <span class="n">main</span><span class="n">(</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">mike</span> <span class="k">:=</span> <span class="n">Student</span><span class="n">{</span><span class="n">Human</span><span class="n">{</span><span class="s">&#34;Mike&#34;</span><span class="n">,</span> <span class="m">25</span><span class="n">,</span> <span class="s">&#34;222-222-XXX&#34;</span><span class="n">}</span><span class="n">,</span> <span class="s">&#34;MIT&#34;</span><span class="n">,</span> <span class="m">0.00</span><span class="n">}</span>
    <span class="n">paul</span> <span class="k">:=</span> <span class="n">Student</span><span class="n">{</span><span class="n">Human</span><span class="n">{</span><span class="s">&#34;Paul&#34;</span><span class="n">,</span> <span class="m">26</span><span class="n">,</span> <span class="s">&#34;111-222-XXX&#34;</span><span class="n">}</span><span class="n">,</span> <span class="s">&#34;Harvard&#34;</span><span class="n">,</span> <span class="m">100</span><span class="n">}</span>
    <span class="n">sam</span> <span class="k">:=</span> <span class="n">Employee</span><span class="n">{</span><span class="n">Human</span><span class="n">{</span><span class="s">&#34;Sam&#34;</span><span class="n">,</span> <span class="m">36</span><span class="n">,</span> <span class="s">&#34;444-222-XXX&#34;</span><span class="n">}</span><span class="n">,</span> <span class="s">&#34;Golang Inc.&#34;</span><span class="n">,</span> <span class="m">1000</span><span class="n">}</span>
    <span class="n">tom</span> <span class="k">:=</span> <span class="n">Employee</span><span class="n">{</span><span class="n">Human</span><span class="n">{</span><span class="s">&#34;Tom&#34;</span><span class="n">,</span> <span class="m">37</span><span class="n">,</span> <span class="s">&#34;222-444-XXX&#34;</span><span class="n">}</span><span class="n">,</span> <span class="s">&#34;Things Ltd.&#34;</span><span class="n">,</span> <span class="m">5000</span><span class="n">}</span>

    <span class="c">//定义Men类型的变量i</span>
    <span class="k">var</span> <span class="n">i</span> <span class="n">Men</span>

    <span class="c">//i能存储Student</span>
    <span class="n">i</span> <span class="k">=</span> <span class="n">mike</span>
    <span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;This is Mike, a Student:&#34;</span><span class="n">)</span>
    <span class="n">i</span><span class="n">.</span><span class="n">SayHi</span><span class="n">(</span><span class="n">)</span>
    <span class="n">i</span><span class="n">.</span><span class="n">Sing</span><span class="n">(</span><span class="s">&#34;November rain&#34;</span><span class="n">)</span>

    <span class="c">//i也能存储Employee</span>
    <span class="n">i</span> <span class="k">=</span> <span class="n">tom</span>
    <span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;This is tom, an Employee:&#34;</span><span class="n">)</span>
    <span class="n">i</span><span class="n">.</span><span class="n">SayHi</span><span class="n">(</span><span class="n">)</span>
    <span class="n">i</span><span class="n">.</span><span class="n">Sing</span><span class="n">(</span><span class="s">&#34;Born to be wild&#34;</span><span class="n">)</span>

    <span class="c">//定义了slice Men</span>
    <span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;Let&#39;s use a slice of Men and see what happens&#34;</span><span class="n">)</span>
    <span class="n">x</span> <span class="k">:=</span> <span class="n">make</span><span class="n">(</span><span class="n">[</span><span class="n">]</span><span class="n">Men</span><span class="n">,</span> <span class="m">3</span><span class="n">)</span>
    <span class="c">//这三个都是不同类型的元素，但是他们实现了interface同一个接口</span>
    <span class="n">x</span><span class="n">[</span><span class="m">0</span><span class="n">]</span><span class="n">,</span> <span class="n">x</span><span class="n">[</span><span class="m">1</span><span class="n">]</span><span class="n">,</span> <span class="n">x</span><span class="n">[</span><span class="m">2</span><span class="n">]</span> <span class="k">=</span> <span class="n">paul</span><span class="n">,</span> <span class="n">sam</span><span class="n">,</span> <span class="n">mike</span>

    <span class="k">for</span> <span class="n">_</span><span class="n">,</span> <span class="n">value</span> <span class="k">:=</span> <span class="k">range</span> <span class="n">x</span><span class="n">{</span>
        <span class="n">value</span><span class="n">.</span><span class="n">SayHi</span><span class="n">(</span><span class="n">)</span>
    <span class="n">}</span>
<span class="n">}</span>
</pre></div>

<p>通过上面的代码，你会发现interface就是一组抽象方法的集合，它必须由其他非interface类型实现，而不能自我实现， Go通过interface实现了duck-typing:即&#34;当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被称为鸭子&#34;。</p>
<h3><a name="空interface" class="anchor" href="#%E7%A9%BAinterface" rel="nofollow" aria-hidden="true"><span class="octicon octicon-link"></span></a>
空interface</h3>

<p>空interface(interface{})不包含任何的method，正因为如此，所有的类型都实现了空interface。空interface对于描述起不到任何的作用(因为它不包含任何的method），但是空interface在我们需要存储任意类型的数值的时候相当有用，因为它可以存储任意类型的数值。它有点类似于C语言的void*类型。</p>

<div class="highlight highlight-Go"><pre>
<span class="c">// 定义a为空接口</span>
<span class="k">var</span> <span class="n">a</span> <span class="k">interface</span><span class="n">{</span><span class="n">}</span>
<span class="k">var</span> <span class="n">i</span> <span class="n">int</span> <span class="k">=</span> <span class="m">5</span>
<span class="n">s</span> <span class="k">:=</span> <span class="s">&#34;Hello world&#34;</span>
<span class="c">// a可以存储任意类型的数值</span>
<span class="n">a</span> <span class="k">=</span> <span class="n">i</span>
<span class="n">a</span> <span class="k">=</span> <span class="n">s</span>
</pre></div>

<p>一个函数把interface{}作为参数，那么他可以接受任意类型的值作为参数，如果一个函数返回interface{},那么也就可以返回任意类型的值。是不是很有用啊！</p>
<h3><a name="interface函数参数" class="anchor" href="#interface%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0" rel="nofollow" aria-hidden="true"><span class="octicon octicon-link"></span></a>
interface函数参数</h3>

<p>interface的变量可以持有任意实现该interface类型的对象，这给我们编写函数(包括method)提供了一些额外的思考，我们是不是可以通过定义interface参数，让函数接受各种类型的参数。</p>

<p>举个例子：fmt.Println是我们常用的一个函数，但是你是否注意到它可以接受任意类型的数据。打开fmt的源码文件，你会看到这样一个定义:</p>

<div class="highlight highlight-Go"><pre>
<span class="k">type</span> <span class="n">Stringer</span> <span class="k">interface</span> <span class="n">{</span>
     <span class="n">String</span><span class="n">(</span><span class="n">)</span> <span class="n">string</span>
<span class="n">}</span>
</pre></div>

<p>也就是说，任何实现了String方法的类型都能作为参数被fmt.Println调用,让我们来试一试</p>

<div class="highlight highlight-Go"><pre>
<span class="k">package</span> <span class="n">main</span>
<span class="k">import</span> <span class="n">(</span>
    <span class="s">&#34;fmt&#34;</span>
    <span class="s">&#34;strconv&#34;</span>
<span class="n">)</span>

<span class="k">type</span> <span class="n">Human</span> <span class="k">struct</span> <span class="n">{</span>
    <span class="n">name</span> <span class="n">string</span>
    <span class="n">age</span> <span class="n">int</span>
    <span class="n">phone</span> <span class="n">string</span>
<span class="n">}</span>

<span class="c">// 通过这个方法 Human 实现了 fmt.Stringer</span>
<span class="k">func</span> <span class="n">(</span><span class="n">h</span> <span class="n">Human</span><span class="n">)</span> <span class="n">String</span><span class="n">(</span><span class="n">)</span> <span class="n">string</span> <span class="n">{</span>
    <span class="k">return</span> <span class="s">&#34;❰&#34;</span><span class="k">+</span><span class="n">h</span><span class="n">.</span><span class="n">name</span><span class="k">+</span><span class="s">&#34; - &#34;</span><span class="k">+</span><span class="n">strconv</span><span class="n">.</span><span class="n">Itoa</span><span class="n">(</span><span class="n">h</span><span class="n">.</span><span class="n">age</span><span class="n">)</span><span class="k">+</span><span class="s">&#34; years -  ✆ &#34;</span> <span class="k">+</span><span class="n">h</span><span class="n">.</span><span class="n">phone</span><span class="k">+</span><span class="s">&#34;❱&#34;</span>
<span class="n">}</span>

<span class="k">func</span> <span class="n">main</span><span class="n">(</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">Bob</span> <span class="k">:=</span> <span class="n">Human</span><span class="n">{</span><span class="s">&#34;Bob&#34;</span><span class="n">,</span> <span class="m">39</span><span class="n">,</span> <span class="s">&#34;000-7777-XXX&#34;</span><span class="n">}</span>
    <span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;This Human is : &#34;</span><span class="n">,</span> <span class="n">Bob</span><span class="n">)</span>
<span class="n">}</span>
</pre></div>

<p>现在我们再回顾一下前面的Box示例，你会发现Color结构也定义了一个method：String。其实这也是实现了fmt.Stringer这个interface，即如果需要某个类型能被fmt包以特殊的格式输出，你就必须实现Stringer这个接口。如果没有实现这个接口，fmt将以默认的方式输出。</p>

<div class="highlight highlight-Go"><pre>
<span class="c">//实现同样的功能</span>
<span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;The biggest one is&#34;</span><span class="n">,</span> <span class="n">boxes</span><span class="n">.</span><span class="n">BiggestsColor</span><span class="n">(</span><span class="n">)</span><span class="n">.</span><span class="n">String</span><span class="n">(</span><span class="n">)</span><span class="n">)</span>
<span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;The biggest one is&#34;</span><span class="n">,</span> <span class="n">boxes</span><span class="n">.</span><span class="n">BiggestsColor</span><span class="n">(</span><span class="n">)</span><span class="n">)</span>
</pre></div>

<p>注：实现了error接口的对象（即实现了Error() string的对象），使用fmt输出时，会调用Error()方法，因此不必再定义String()方法了。</p>
<h3><a name="interface变量存储的类型" class="anchor" href="#interface%E5%8F%98%E9%87%8F%E5%AD%98%E5%82%A8%E7%9A%84%E7%B1%BB%E5%9E%8B" rel="nofollow" aria-hidden="true"><span class="octicon octicon-link"></span></a>
interface变量存储的类型</h3>

<p>我们知道interface的变量里面可以存储任意类型的数值(该类型实现了interface)。那么我们怎么反向知道这个变量里面实际保存了的是哪个类型的对象呢？目前常用的有两种方法：</p>

<ul>
<li><p>Comma-ok断言</p>

<p>Go语言里面有一个语法，可以直接判断是否是该类型的变量： value, ok = element.(T)，这里value就是变量的值，ok是一个bool类型，element是interface变量，T是断言的类型。</p>

<p>如果element里面确实存储了T类型的数值，那么ok返回true，否则返回false。</p>

<p>让我们通过一个例子来更加深入的理解。</p>

<div class="highlight highlight-Go"><pre>
<span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="n">(</span>
    <span class="s">&#34;fmt&#34;</span>
    <span class="s">&#34;strconv&#34;</span>
<span class="n">)</span>

<span class="k">type</span> <span class="n">Element</span> <span class="k">interface</span><span class="n">{</span><span class="n">}</span>
<span class="k">type</span> <span class="n">List</span> <span class="n">[</span><span class="n">]</span> <span class="n">Element</span>

<span class="k">type</span> <span class="n">Person</span> <span class="k">struct</span> <span class="n">{</span>
    <span class="n">name</span> <span class="n">string</span>
    <span class="n">age</span> <span class="n">int</span>
<span class="n">}</span>

<span class="c">//定义了String方法，实现了fmt.Stringer</span>
<span class="k">func</span> <span class="n">(</span><span class="n">p</span> <span class="n">Person</span><span class="n">)</span> <span class="n">String</span><span class="n">(</span><span class="n">)</span> <span class="n">string</span> <span class="n">{</span>
    <span class="k">return</span> <span class="s">&#34;(name: &#34;</span> <span class="k">+</span> <span class="n">p</span><span class="n">.</span><span class="n">name</span> <span class="k">+</span> <span class="s">&#34; - age: &#34;</span><span class="k">+</span><span class="n">strconv</span><span class="n">.</span><span class="n">Itoa</span><span class="n">(</span><span class="n">p</span><span class="n">.</span><span class="n">age</span><span class="n">)</span><span class="k">+</span> <span class="s">&#34; years)&#34;</span>
<span class="n">}</span>

<span class="k">func</span> <span class="n">main</span><span class="n">(</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">list</span> <span class="k">:=</span> <span class="n">make</span><span class="n">(</span><span class="n">List</span><span class="n">,</span> <span class="m">3</span><span class="n">)</span>
    <span class="n">list</span><span class="n">[</span><span class="m">0</span><span class="n">]</span> <span class="k">=</span> <span class="m">1</span> <span class="c">// an int</span>
    <span class="n">list</span><span class="n">[</span><span class="m">1</span><span class="n">]</span> <span class="k">=</span> <span class="s">&#34;Hello&#34;</span> <span class="c">// a string</span>
    <span class="n">list</span><span class="n">[</span><span class="m">2</span><span class="n">]</span> <span class="k">=</span> <span class="n">Person</span><span class="n">{</span><span class="s">&#34;Dennis&#34;</span><span class="n">,</span> <span class="m">70</span><span class="n">}</span>

    <span class="k">for</span> <span class="n">index</span><span class="n">,</span> <span class="n">element</span> <span class="k">:=</span> <span class="k">range</span> <span class="n">list</span> <span class="n">{</span>
        <span class="k">if</span> <span class="n">value</span><span class="n">,</span> <span class="n">ok</span> <span class="k">:=</span> <span class="n">element</span><span class="n">.</span><span class="n">(</span><span class="n">int</span><span class="n">)</span><span class="n">;</span> <span class="n">ok</span> <span class="n">{</span>
            <span class="n">fmt</span><span class="n">.</span><span class="n">Printf</span><span class="n">(</span><span class="s">&#34;list[%d] is an int and its value is %d\n&#34;</span><span class="n">,</span> <span class="n">index</span><span class="n">,</span> <span class="n">value</span><span class="n">)</span>
        <span class="n">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">value</span><span class="n">,</span> <span class="n">ok</span> <span class="k">:=</span> <span class="n">element</span><span class="n">.</span><span class="n">(</span><span class="n">string</span><span class="n">)</span><span class="n">;</span> <span class="n">ok</span> <span class="n">{</span>
            <span class="n">fmt</span><span class="n">.</span><span class="n">Printf</span><span class="n">(</span><span class="s">&#34;list[%d] is a string and its value is %s\n&#34;</span><span class="n">,</span> <span class="n">index</span><span class="n">,</span> <span class="n">value</span><span class="n">)</span>
        <span class="n">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">value</span><span class="n">,</span> <span class="n">ok</span> <span class="k">:=</span> <span class="n">element</span><span class="n">.</span><span class="n">(</span><span class="n">Person</span><span class="n">)</span><span class="n">;</span> <span class="n">ok</span> <span class="n">{</span>
            <span class="n">fmt</span><span class="n">.</span><span class="n">Printf</span><span class="n">(</span><span class="s">&#34;list[%d] is a Person and its value is %s\n&#34;</span><span class="n">,</span> <span class="n">index</span><span class="n">,</span> <span class="n">value</span><span class="n">)</span>
        <span class="n">}</span> <span class="k">else</span> <span class="n">{</span>
            <span class="n">fmt</span><span class="n">.</span><span class="n">Printf</span><span class="n">(</span><span class="s">&#34;list[%d] is of a different type\n&#34;</span><span class="n">,</span> <span class="n">index</span><span class="n">)</span>
        <span class="n">}</span>
    <span class="n">}</span>
<span class="n">}</span>
</pre></div>

<p>是不是很简单啊，同时你是否注意到了多个if里面，还记得我前面介绍流程时讲过，if里面允许初始化变量。</p>

<p>也许你注意到了，我们断言的类型越多，那么if else也就越多，所以才引出了下面要介绍的switch。</p></li>

<li><p>switch测试</p>

<p>最好的讲解就是代码例子，现在让我们重写上面的这个实现</p>

<div class="highlight highlight-Go"><pre>
<span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="n">(</span>
    <span class="s">&#34;fmt&#34;</span>
    <span class="s">&#34;strconv&#34;</span>
<span class="n">)</span>

<span class="k">type</span> <span class="n">Element</span> <span class="k">interface</span><span class="n">{</span><span class="n">}</span>
<span class="k">type</span> <span class="n">List</span> <span class="n">[</span><span class="n">]</span> <span class="n">Element</span>

<span class="k">type</span> <span class="n">Person</span> <span class="k">struct</span> <span class="n">{</span>
    <span class="n">name</span> <span class="n">string</span>
    <span class="n">age</span> <span class="n">int</span>
<span class="n">}</span>

<span class="c">//打印</span>
<span class="k">func</span> <span class="n">(</span><span class="n">p</span> <span class="n">Person</span><span class="n">)</span> <span class="n">String</span><span class="n">(</span><span class="n">)</span> <span class="n">string</span> <span class="n">{</span>
    <span class="k">return</span> <span class="s">&#34;(name: &#34;</span> <span class="k">+</span> <span class="n">p</span><span class="n">.</span><span class="n">name</span> <span class="k">+</span> <span class="s">&#34; - age: &#34;</span><span class="k">+</span><span class="n">strconv</span><span class="n">.</span><span class="n">Itoa</span><span class="n">(</span><span class="n">p</span><span class="n">.</span><span class="n">age</span><span class="n">)</span><span class="k">+</span> <span class="s">&#34; years)&#34;</span>
<span class="n">}</span>

<span class="k">func</span> <span class="n">main</span><span class="n">(</span><span class="n">)</span> <span class="n">{</span>
    <span class="n">list</span> <span class="k">:=</span> <span class="n">make</span><span class="n">(</span><span class="n">List</span><span class="n">,</span> <span class="m">3</span><span class="n">)</span>
    <span class="n">list</span><span class="n">[</span><span class="m">0</span><span class="n">]</span> <span class="k">=</span> <span class="m">1</span> <span class="c">//an int</span>
    <span class="n">list</span><span class="n">[</span><span class="m">1</span><span class="n">]</span> <span class="k">=</span> <span class="s">&#34;Hello&#34;</span> <span class="c">//a string</span>
    <span class="n">list</span><span class="n">[</span><span class="m">2</span><span class="n">]</span> <span class="k">=</span> <span class="n">Person</span><span class="n">{</span><span class="s">&#34;Dennis&#34;</span><span class="n">,</span> <span class="m">70</span><span class="n">}</span>

    <span class="k">for</span> <span class="n">index</span><span class="n">,</span> <span class="n">element</span> <span class="k">:=</span> <span class="k">range</span> <span class="n">list</span><span class="n">{</span>
        <span class="k">switch</span> <span class="n">value</span> <span class="k">:=</span> <span class="n">element</span><span class="n">.</span><span class="n">(</span><span class="k">type</span><span class="n">)</span> <span class="n">{</span>
            <span class="k">case</span> <span class="n">int</span><span class="n">:</span>
                <span class="n">fmt</span><span class="n">.</span><span class="n">Printf</span><span class="n">(</span><span class="s">&#34;list[%d] is an int and its value is %d\n&#34;</span><span class="n">,</span> <span class="n">index</span><span class="n">,</span> <span class="n">value</span><span class="n">)</span>
            <span class="k">case</span> <span class="n">string</span><span class="n">:</span>
                <span class="n">fmt</span><span class="n">.</span><span class="n">Printf</span><span class="n">(</span><span class="s">&#34;list[%d] is a string and its value is %s\n&#34;</span><span class="n">,</span> <span class="n">index</span><span class="n">,</span> <span class="n">value</span><span class="n">)</span>
            <span class="k">case</span> <span class="n">Person</span><span class="n">:</span>
                <span class="n">fmt</span><span class="n">.</span><span class="n">Printf</span><span class="n">(</span><span class="s">&#34;list[%d] is a Person and its value is %s\n&#34;</span><span class="n">,</span> <span class="n">index</span><span class="n">,</span> <span class="n">value</span><span class="n">)</span>
            <span class="k">default</span><span class="n">:</span>
                <span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;list[%d] is of a different type&#34;</span><span class="n">,</span> <span class="n">index</span><span class="n">)</span>
        <span class="n">}</span>
    <span class="n">}</span>
<span class="n">}</span>
</pre></div>

<p>这里有一点需要强调的是：<code>element.(type)</code>语法不能在switch外的任何逻辑里面使用，如果你要在switch外面判断一个类型就使用<code>comma-ok</code>。</p></li>
</ul>
<h3><a name="嵌入interface" class="anchor" href="#%E5%B5%8C%E5%85%A5interface" rel="nofollow" aria-hidden="true"><span class="octicon octicon-link"></span></a>
嵌入interface</h3>

<p>Go里面真正吸引人的是它内置的逻辑语法，就像我们在学习Struct时学习的匿名字段，多么的优雅啊，那么相同的逻辑引入到interface里面，那不是更加完美了。如果一个interface1作为interface2的一个嵌入字段，那么interface2隐式的包含了interface1里面的method。</p>

<p>我们可以看到源码包container/heap里面有这样的一个定义</p>

<div class="highlight highlight-Go"><pre>
<span class="k">type</span> <span class="n">Interface</span> <span class="k">interface</span> <span class="n">{</span>
    <span class="n">sort</span><span class="n">.</span><span class="n">Interface</span> <span class="c">//嵌入字段sort.Interface</span>
    <span class="n">Push</span><span class="n">(</span><span class="n">x</span> <span class="k">interface</span><span class="n">{</span><span class="n">}</span><span class="n">)</span> <span class="c">//a Push method to push elements into the heap</span>
    <span class="n">Pop</span><span class="n">(</span><span class="n">)</span> <span class="k">interface</span><span class="n">{</span><span class="n">}</span> <span class="c">//a Pop elements that pops elements from the heap</span>
<span class="n">}</span>
</pre></div>

<p>我们看到sort.Interface其实就是嵌入字段，把sort.Interface的所有method给隐式的包含进来了。也就是下面三个方法：</p>

<div class="highlight highlight-Go"><pre>
<span class="k">type</span> <span class="n">Interface</span> <span class="k">interface</span> <span class="n">{</span>
    <span class="c">// Len is the number of elements in the collection.</span>
    <span class="n">Len</span><span class="n">(</span><span class="n">)</span> <span class="n">int</span>
    <span class="c">// Less returns whether the element with index i should sort</span>
    <span class="c">// before the element with index j.</span>
    <span class="n">Less</span><span class="n">(</span><span class="n">i</span><span class="n">,</span> <span class="n">j</span> <span class="n">int</span><span class="n">)</span> <span class="n">bool</span>
    <span class="c">// Swap swaps the elements with indexes i and j.</span>
    <span class="n">Swap</span><span class="n">(</span><span class="n">i</span><span class="n">,</span> <span class="n">j</span> <span class="n">int</span><span class="n">)</span>
<span class="n">}</span>
</pre></div>

<p>另一个例子就是io包下面的 io.ReadWriter ，它包含了io包下面的Reader和Writer两个interface：</p>

<div class="highlight highlight-Go"><pre>
<span class="c">// io.ReadWriter</span>
<span class="k">type</span> <span class="n">ReadWriter</span> <span class="k">interface</span> <span class="n">{</span>
    <span class="n">Reader</span>
    <span class="n">Writer</span>
<span class="n">}</span>
</pre></div>
<h3><a name="反射" class="anchor" href="#%E5%8F%8D%E5%B0%84" rel="nofollow" aria-hidden="true"><span class="octicon octicon-link"></span></a>
反射</h3>

<p>Go语言实现了反射，所谓反射就是能检查程序在运行时的状态。我们一般用到的包是reflect包。如何运用reflect包，官方的这篇文章详细的讲解了reflect包的实现原理，<a href="http://golang.org/doc/articles/laws_of_reflection.html" rel="nofollow">laws of reflection</a></p>

<p>使用reflect一般分成三步，下面简要的讲解一下：要去反射是一个类型的值(这些值都实现了空interface)，首先需要把它转化成reflect对象(reflect.Type或者reflect.Value，根据不同的情况调用不同的函数)。这两种获取方式如下：</p>

<div class="highlight highlight-Go"><pre>
<span class="n">t</span> <span class="k">:=</span> <span class="n">reflect</span><span class="n">.</span><span class="n">TypeOf</span><span class="n">(</span><span class="n">i</span><span class="n">)</span>    <span class="c">//得到类型的元数据,通过t我们能获取类型定义里面的所有元素</span>
<span class="n">v</span> <span class="k">:=</span> <span class="n">reflect</span><span class="n">.</span><span class="n">ValueOf</span><span class="n">(</span><span class="n">i</span><span class="n">)</span>   <span class="c">//得到实际的值，通过v我们获取存储在里面的值，还可以去改变值</span>
</pre></div>

<p>转化为reflect对象之后我们就可以进行一些操作了，也就是将reflect对象转化成相应的值，例如</p>

<div class="highlight highlight-Go"><pre>
<span class="n">tag</span> <span class="k">:=</span> <span class="n">t</span><span class="n">.</span><span class="n">Elem</span><span class="n">(</span><span class="n">)</span><span class="n">.</span><span class="n">Field</span><span class="n">(</span><span class="m">0</span><span class="n">)</span><span class="n">.</span><span class="n">Tag</span>  <span class="c">//获取定义在struct里面的标签</span>
<span class="n">name</span> <span class="k">:=</span> <span class="n">v</span><span class="n">.</span><span class="n">Elem</span><span class="n">(</span><span class="n">)</span><span class="n">.</span><span class="n">Field</span><span class="n">(</span><span class="m">0</span><span class="n">)</span><span class="n">.</span><span class="n">String</span><span class="n">(</span><span class="n">)</span>  <span class="c">//获取存储在第一个字段里面的值</span>
</pre></div>

<p>获取反射值能返回相应的类型和数值</p>

<div class="highlight highlight-Go"><pre>
<span class="k">var</span> <span class="n">x</span> <span class="n">float64</span> <span class="k">=</span> <span class="m">3.4</span>
<span class="n">v</span> <span class="k">:=</span> <span class="n">reflect</span><span class="n">.</span><span class="n">ValueOf</span><span class="n">(</span><span class="n">x</span><span class="n">)</span>
<span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;type:&#34;</span><span class="n">,</span> <span class="n">v</span><span class="n">.</span><span class="n">Type</span><span class="n">(</span><span class="n">)</span><span class="n">)</span>
<span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;kind is float64:&#34;</span><span class="n">,</span> <span class="n">v</span><span class="n">.</span><span class="n">Kind</span><span class="n">(</span><span class="n">)</span> <span class="k">==</span> <span class="n">reflect</span><span class="n">.</span><span class="n">Float64</span><span class="n">)</span>
<span class="n">fmt</span><span class="n">.</span><span class="n">Println</span><span class="n">(</span><span class="s">&#34;value:&#34;</span><span class="n">,</span> <span class="n">v</span><span class="n">.</span><span class="n">Float</span><span class="n">(</span><span class="n">)</span><span class="n">)</span>
</pre></div>

<p>最后，反射的话，那么反射的字段必须是可修改的，我们前面学习过传值和传引用，这个里面也是一样的道理。反射的字段必须是可读写的意思是，如果下面这样写，那么会发生错误</p>

<div class="highlight highlight-Go"><pre>
<span class="k">var</span> <span class="n">x</span> <span class="n">float64</span> <span class="k">=</span> <span class="m">3.4</span>
<span class="n">v</span> <span class="k">:=</span> <span class="n">reflect</span><span class="n">.</span><span class="n">ValueOf</span><span class="n">(</span><span class="n">x</span><span class="n">)</span>
<span class="n">v</span><span class="n">.</span><span class="n">SetFloat</span><span class="n">(</span><span class="m">7.1</span><span class="n">)</span>
</pre></div>

<p>如果要修改相应的值，必须这样写</p>

<div class="highlight highlight-Go"><pre>
<span class="k">var</span> <span class="n">x</span> <span class="n">float64</span> <span class="k">=</span> <span class="m">3.4</span>
<span class="n">p</span> <span class="k">:=</span> <span class="n">reflect</span><span class="n">.</span><span class="n">ValueOf</span><span class="n">(</span><span class="k">&amp;</span><span class="n">x</span><span class="n">)</span>
<span class="n">v</span> <span class="k">:=</span> <span class="n">p</span><span class="n">.</span><span class="n">Elem</span><span class="n">(</span><span class="n">)</span>
<span class="n">v</span><span class="n">.</span><span class="n">SetFloat</span><span class="n">(</span><span class="m">7.1</span><span class="n">)</span>
</pre></div>

<p>上面只是对反射的简单介绍，更深入的理解还需要自己在编程中不断的实践。</p>
<h2><a name="links" class="anchor" href="#links" rel="nofollow" aria-hidden="true"><span class="octicon octicon-link"></span></a>
links</h2>

<ul>
<li><a href="preface.md" rel="nofollow">目录</a></li>
<li>上一章: <a href="02.5.md" rel="nofollow">面向对象</a></li>
<li>下一节: <a href="/book/0day/2" rel="nofollow">并发</a></li>
</ul>

</div>
    
        <div id="disqus_thread"></div>
        <script>
            

            

            (function() { 
                var d = document, s = d.createElement('script');
                s.src = 'https://worldofcodemonkey.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
    </div>
</main>
<footer>
    &copy; Copyright 2018 by 码农大陆 World of CodeMonkey.
</footer>

</body>
</html>
